##### 为什么要优化

前段时间花了一点时间把公司目前在运营的一个活动页配置功能做了一次性能优化的升级，原因是发现用该模块配置出来的活动页在某些情况下会莫名报一些类似`juqery undefined `或者是`template undefined`的问题。另外活动页的加载也比较慢。鉴于这个功能开发的时候是为了赶进度，并未采用一些依赖分析加载的工具和框架，而且该模块是旧官网功能，旧官网目前仍是`jsp`项目，因此采用的是用`requirejs`做依赖分析，用`r.js`做压缩合并的方案。

> 鉴于公司是金融行业，具体的代码涉及公司隐私，就不贴出来。

##### 为什么选requirejs和r.js

首先回到上面提到的两个问题：

1. 第三库的引用是顺序引用，为什么会偶尔出现引用方找不到变量的情况？
2. 活动页配置功能配置出来的页面加载速度比较慢，是什么原因？

第一个问题其实还是比较困扰我的，因为这种情况一直无法复现和定位，一种可能的猜测是由于网络及超出浏览器网络请求并发上限的原因导致第三方库加载失败，而业务代码加载成功，自然就会出现这种情况。所以讲页面请求资源按需加载，再合并压缩请求，至少能尽量减少这种问题的发生。

第二个问题的原因大体上和第一个差不多，页面静态资源并未做处理，在移动端网络下容易造成加载缓慢的情况。

而requirejs和r.js正是解决这一类问题的利器。